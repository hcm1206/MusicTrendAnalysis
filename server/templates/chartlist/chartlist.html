{% extends 'base.html' %}

<!-- static 로드 -->
{% load static %}

{% block title %}TOP 200{% endblock %}

{% block style %}
<style>
    /* 메인 컨테이너 스타일 */
    #main-wrapper {
        padding: 0 10%;
        max-width: 1200px;
        margin: auto;
        text-align: center;
    }
    
    #main-wrapper > h1 {
        margin: 40px 0 20px;
        font-size: 3em;
        font-weight: 700;
        color: #333;
        letter-spacing: 2px;
        text-transform: uppercase;
        transition: transform 0.3s ease;
    }

    #main-wrapper > h1:hover {
        transform: scale(1.05);
    }

    /* 날짜 컨테이너 스타일 */
    #date-container {
        margin: 20px 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    #date-label {
        font-size: 1.2em;
        font-weight: bold;
        margin-right: 15px;
        color: #666;
        transition: color 0.3s ease;
    }

    #date-label:hover {
        color: #000;
    }

    /* 날짜 선택 버튼 애니메이션 */
    .date-calendar-toggle {
        width: 40px;
        height: 40px;
        background-color: #555;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        z-index: 10; /* 높은 z-index 설정 */
    }
    
    .date-calendar-toggle:hover {
        transform: scale(1.1);
        background-color: #333;
    }

    .date-calendar-toggle-button {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-image: url("{% static 'image/calendar-icon.svg' %}");
    }
    
    #date-calendar-input {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
        box-sizing: border-box;
    }

    /* 테이블 스타일 */
    #table-wrapper {
        margin-top: 40px;
        width: 100%;
        overflow-x: auto;
    }

    #chart_table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin: 20px 0;
        border: none;
        box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        font-family: 'Arial', sans-serif;
    }

    /* 테이블 헤더와 데이터 셀 스타일 */
    #chart_table th, #chart_table td {
        padding: 15px 20px;
        border-bottom: 1px solid #e0e0e0;
        background-color: #fff;
        color: #555;
    }

    #chart_table th {
        font-weight: 700;
        background-color: #f9f9f9;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* 테이블 첫 번째 행 스타일 */
    #chart_table tr:first-child th {
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
    }

    #chart_table tr:last-child td {
        border-bottom-left-radius: 15px;
        border-bottom-right-radius: 15px;
    }

    /* 행 마우스오버 애니메이션 */
    .chart-content {
        transition: background-color 0.2s ease-in-out;
        cursor: pointer;
    }

    .chart-content:hover {
        background-color: #f0f0f0;
    }

    /* 오버레이 전체화면 이미지 */
    #intro-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7); /* 검은색 배경에 투명도 */
        z-index: 9999; /* 최상위 */
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 1;
        animation: fadeInOut 6s ease-in-out; /* 페이드인 페이드아웃 애니메이션 */
    }

    @keyframes fadeInOut {
        0% {
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            opacity: 0;
        }
    }

    #intro-image {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
    }

    /* 페이드아웃 후 숨김 */
    #intro-overlay.hidden {
        opacity: 0;
        visibility: hidden;
    }





/* 오버레이 스타일 */
#intro-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #00FFCC; /* 민트색 배경 */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999; /* 최상위 */
    animation: slideIn 1s ease forwards, slideOut 2s ease forwards 1s; /* 2초 후 화면 사라짐 */
}

/* 로딩 텍스트 스타일 */
#loading-text {
    font-size: 4em;
    font-weight: bold;
    color: #fff;
    text-transform: uppercase;
    animation: fadeInText 1s ease forwards;
}

/* 텍스트 페이드 인 애니메이션 */
@keyframes fadeInText {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

/* 화면이 위에서 아래로 내려오는 애니메이션 */
@keyframes slideIn {
    0% {
        transform: translateY(-100%);
    }
    100% {
        transform: translateY(0);
    }
}

/* 화면이 아래로 사라지는 애니메이션 */
@keyframes slideOut {
    0% {
        transform: translateY(0);
        opacity: 1;
    }
    100% {
        transform: translateY(100%);
        opacity: 0;
    }
}

/* 애니메이션 후 숨김 처리 */
#intro-overlay.hidden {
    display: none;
}



/* 기본 스타일 */
th {
    position: relative;
    font-size: 1.5em;
    cursor: pointer;
}

/* 글자에 애니메이션을 적용할 클래스 */
.letter {
    display: inline-block;
    transition: transform 0.2s ease;
}

/* 글자가 5px 위로 올라가는 클래스 */
.letter-up {
    transform: translateY(-5px);
}




/* 기본 행 스타일 */
.chart-content {
    transition: transform 0.3s ease, box-shadow 0.3s ease;  /* 크기와 테두리 변화 애니메이션 */
}

/* 마우스를 올렸을 때 행이 살짝 커지고 테두리가 빛나게 함 */
.chart-content:hover {
    transform: scale(1.03);  /* 3% 확대 */
    box-shadow: 0 4px 15px rgba(225, 145, 40, 0.9);   /* 테두리가 빛나도록 */
}




/* 왼쪽 및 오른쪽 화살표 스타일 */
.date-arrow {
    font-size: 2em;
    cursor: pointer;
    margin: 0 10px;
    color: #666;
    transition: color 0.3s ease;
}

.date-arrow:hover {
    color: #000;
}




/* 민트색 배경 오버레이 */
#loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #00FFCC; /* 민트색 */
    z-index: 10000; /* 최상위로 설정 */
    display: flex;
    justify-content: center;
    align-items: center;
}



body {
    transition: background-color 0.3s ease;  /* 배경색 변경 시 부드러운 전환 효과 */
}





</style>
{% endblock %}

{% block startscript %}
{% endblock %}

<!-- 인덱스 적용 탬플릿 필터 사용하기 위함 -->
{% load custom_filters %}

{% block content %}


<div id="loading-overlay"></div> <!-- 민트색 배경 추가 -->
<!-- 전체 화면을 덮는 이미지 오버레이 -->
<div id="intro-overlay">
    <!-- <img src="{% static 'jpg/screen.jpg' %}" alt="Intro Image" id="intro-image"> -->
    <div id="loading-text">L O A D I N G ......</div>
</div>

<div id="main-wrapper">
    <h1>Circle Chart TOP 200</h1>
    <div id="date-container">
        <!-- 왼쪽 화살표 (일주일 전) -->
        <span class="date-arrow" id="prev-week">&#8592;</span> <!-- ← (왼쪽 화살표) -->
    
        <!-- 날짜 라벨 -->
        <div id="date-label">{{year}}년 {{month}}월 {{day}}일 기준</div>
    
        <!-- 오른쪽 화살표 (일주일 후) -->
        <span class="date-arrow" id="next-week">&#8594;</span> <!-- → (오른쪽 화살표) -->
    
        <!-- 날짜 선택 입력 -->
        <span class="date-calendar-toggle">
            <span class="date-calendar-toggle-button"></span>
            <input type="date" id="date-calendar-input">
        </span>





    </div>
    <div id="table-wrapper">
        <table id="chart_table">
            <thead>
                <tr>
                    <!-- <th>Rank</th>
                    <th>Title</th>
                    <th>Artist</th> -->
                    <th id="rank-header">Rank</th>
                    <th id="title-header">Title</th>
                    <th id="artist-header">Artist</th>
                </tr>
            </thead>
            <tbody>
                {% for row in chart_data %}
                <tr class="chart-content" onclick="location.href = '/chartlist/{{date}}/{{row|index:0}}';">
                    {% for row_data in row %}
                    <td>{{ row_data }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block endscript %}
<script>



window.addEventListener('load', function() {
    // 민트색 배경을 1초 동안 페이드 아웃
    setTimeout(function() {
        document.getElementById('loading-overlay').style.transition = 'opacity 2s ease';
        document.getElementById('loading-overlay').style.opacity = 0;

        // 1초 후 민트색 배경 제거
        setTimeout(function() {
            document.getElementById('loading-overlay').remove();

            // intro-overlay 페이드 아웃 (기존 동작)
            setTimeout(function() {
                document.getElementById('intro-overlay').classList.add('hidden');
            }, 4000); // 5초 후 intro-overlay 숨김
        }, 2000); // 민트색 배경 페이드 아웃 시간 (2초)

    }, 500); // 페이지 로드 후 0.5초 대기 후 민트색 배경 페이드아웃 시작
});








// 각 글자에 애니메이션 적용 함수
function animateHeader(headerId) {
    const header = document.getElementById(headerId);
    const text = header.textContent;
    header.innerHTML = '';  // 기존 텍스트를 지우고

    // 각 글자를 span 태그로 감싸고 클래스를 적용
    for (let i = 0; i < text.length; i++) {
        const span = document.createElement('span');
        span.classList.add('letter');
        span.textContent = text[i];
        header.appendChild(span);
    }

    // 각 글자에 순차적으로 애니메이션 적용
    const letters = header.querySelectorAll('.letter');
    letters.forEach((letter, index) => {
        setTimeout(() => {
            letter.classList.add('letter-up');
            setTimeout(() => {
                letter.classList.remove('letter-up');
            }, 200);  // 0.2초 후 다시 내려감
        }, index * 400);  // 각 글자는 0.4초 간격으로 애니메이션 실행
    });
}

// 각 헤더 요소에 마우스를 올렸을 때 애니메이션 실행
document.getElementById('rank-header').addEventListener('mouseenter', function() {
    animateHeader('rank-header');
});
document.getElementById('title-header').addEventListener('mouseenter', function() {
    animateHeader('title-header');
});
document.getElementById('artist-header').addEventListener('mouseenter', function() {
    animateHeader('artist-header');
});









 // URL에서 현재 날짜 추출 함수
 function getDateFromURL() {
        const url = window.location.pathname;
        const dateMatch = url.match(/(\d{4}-\d{2}-\d{2})/);
        if (dateMatch) {
            return dateMatch[0];
        }
        // URL에서 날짜가 없으면 기본값을 2024-09-08로 설정
        return '2024-09-08';
    }

    // 선택한 날짜의 첫 번째 일요일을 계산하는 함수
    function getSunday(date) {
        const currentDate = new Date(date);
        const dayOfWeek = currentDate.getDay();  // 0: 일요일, 1: 월요일, ... 6: 토요일
        const diff = currentDate.getDate() - dayOfWeek;  // 일요일까지의 차이 계산
        const sunday = new Date(currentDate.setDate(diff));
        return sunday.toISOString().split('T')[0];  // YYYY-MM-DD 형식으로 반환
    }

    // 날짜를 일주일 단위로 조정하는 함수
    function adjustDate(weeks) {
        const dateInput = document.getElementById('date-calendar-input');
        let currentDate = dateInput.value ? new Date(dateInput.value) : new Date(getDateFromURL());

        // 일주일 단위로 날짜 조정
        currentDate.setDate(currentDate.getDate() + weeks * 7);

        // 해당 주의 첫 번째 일요일을 계산
        const sundayDate = getSunday(currentDate);

        // 입력 필드 업데이트
        dateInput.value = sundayDate;

        // 페이지 내 날짜 표시 업데이트
        const dateLabel = document.getElementById('date-label');
        const sunday = new Date(sundayDate);
        const year = sunday.getFullYear();
        const month = ('0' + (sunday.getMonth() + 1)).slice(-2);  // 월 2자리 형식
        const day = ('0' + sunday.getDate()).slice(-2);  // 일 2자리 형식

        dateLabel.textContent = `${year}년 ${month}월 ${day}일 기준`;  // 일요일 날짜 표시

        // 페이지 이동
        location.href = `/chartlist/${sundayDate}`;  // 새로 계산된 일요일 날짜로 이동
    }

    // 왼쪽 화살표 클릭 시 일주일 전으로 날짜 조정
    document.getElementById('prev-week').addEventListener('click', function() {
        adjustDate(-1);  // 일주일 전
    });

    // 오른쪽 화살표 클릭 시 일주일 후로 날짜 조정
    document.getElementById('next-week').addEventListener('click', function() {
        adjustDate(1);  // 일주일 후
    });

    // 날짜 선택 시 첫 번째 일요일로 변경하여 표시
    document.getElementById('date-calendar-input').addEventListener('change', function(e) {
        const selectedDate = e.target.value;
        const sundayDate = getSunday(selectedDate);  // 선택된 날짜의 일요일 계산
        
        // 일요일 날짜를 페이지의 날짜 라벨에 표시
        const dateLabel = document.getElementById('date-label');
        const sunday = new Date(sundayDate);
        const year = sunday.getFullYear();
        const month = ('0' + (sunday.getMonth() + 1)).slice(-2);  // 월 2자리 형식
        const day = ('0' + sunday.getDate()).slice(-2);  // 일 2자리 형식

        dateLabel.textContent = `${year}년 ${month}월 ${day}일 기준`;  // 일요일 날짜 표시

        // 페이지 이동
        location.href = `/chartlist/${sundayDate}`;  // 새로 계산된 일요일 날짜로 이동
    });

    // 페이지가 로드될 때 URL에서 현재 날짜를 추출하고 입력 필드를 업데이트
    window.addEventListener('load', function() {
        const dateInput = document.getElementById('date-calendar-input');
        const currentURLDate = getDateFromURL();
        dateInput.value = currentURLDate;
    });









// 스크롤에 따라 배경색을 변경하는 함수
window.addEventListener('scroll', function() {
        // 페이지의 총 스크롤 가능한 높이와 현재 스크롤 위치 계산
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = scrollTop / docHeight;

        // 무지개색을 중간 부분에만 적용 (스크롤 비율이 0.2에서 0.8 사이일 때)
        let hue = 0;
        let lightness = 100; // 기본 흰색 (lightness 100%)
        
        if (scrollPercent >= 0.2 && scrollPercent <= 0.8) {
            // 무지개색을 중간에만 적용
            hue = Math.round((scrollPercent - 0.2) / 0.6 * 360);  // hue 값은 0~360으로 설정
            lightness = 80; // 색이 연하게 보이도록 lightness 값을 80%로 설정
        } else if (scrollPercent > 0.8) {
            // 마지막 부분으로 갈수록 흰색으로 변화
            lightness = Math.round(100 - (scrollPercent - 0.8) / 0.2 * 100);  // 끝에서 흰색으로 변화
        }

        // 배경색을 HSL 모델을 사용하여 설정
        document.body.style.backgroundColor = `hsl(${hue}, 100%, ${lightness}%)`;
    });


</script>
{% endblock %}
